# 一、分工任务及解决方案

## 1.     分工任务

1)      Qt图形框架下Window层窗口界面的逻辑层次与架构

2)      控件、背景等UI元素的绘制

3)      控件功能设计，即对用户的操作做出响应

4)      Window层各类信号的处理与反馈

## 2.     解决方案

1)      利用Qt图形设计中GraphicsView，GraphicsScene，GraphicsItem以及其从属关系的概念，将整个用户界面分层实现。

2)      根据其它模块需求来设计控件功能

3)      UI元素绘制使用资源图片进行载入

4)      使用槽函数、信号函数等来实现与其它层之间的沟通

# 二、设计思路

设计的基本思路为只使用一个场景（GraphicsScene），并以事先定义好的坐标来放置其中的物体（GraphicsItem）以及按钮（Button）。同时在窗体运行过程中，对于不同事件，根据需要来决定是否重新绘制对应控件或添加新的控件。

为了实现上述功能，构建了如下类：

**1.**       **Item类**

封装了对物体的基本操作，包括：初始化物体，将物体添加到场景，将物体添加到其父物体，将父物体添加到场景。

**2.**       **numItem类**

用于绘制玩家手中剩余的牌数，以及玩家出牌阶段的计时器。能够根据给定的宽高对牌数进行绘制；并能够根据出牌人的不同对其计时器进行绘制。

**3.**       **cardItem类**

用于绘制玩家的手牌，以及对局中不同玩家打出的牌。能够实现玩家选中牌时的弹出效果，同时也绘制了地主需要公示的四张牌，并实现了抢地主成功后的手牌添加。

**4.**       **headItem类**

用于绘制玩家的头像，能够根据玩家在对局中的属性（农民或地主）来绘制不同的头像。

**5.**       **stateItem类**

用于绘制当前对局的状态以及玩家的状态。具体有玩家准备、叫或不叫地主、过牌、无法出牌、胜负状态。

**6.**       **button类**

用于绘制界面中的按钮，包括准备、进入房间、退出房间、叫或不叫地主、出牌或过牌、继续或退出游戏等。

**7.**       **window类（层）**

window类对整个场景及所属物体、按钮进行初始化，载入背景图片，并且对各项参数进行设定。同时，根据对局的各种状态，调用上述所有类，对场景进行实时绘制。同时，通过绑定，window类实现了各类按钮的点击事件及相关信号处理。并且window拥有鼠标点击事件（Mouse Press Event）用来反馈用户选中的牌。成员即为上述的几种类，以及场景（QGraphicsScene类型）。

一些重要功能的实现如下所述：

**1.**       **界面实时更新**

通过读取三个玩家不同的状态信号，来添加、去除或修改场景中的物体。

**2.**       **按钮点击事件**

在按钮点击后，将信号的值改变为对应的宏再发出（emit）即可。

**3.**       **鼠标点击事件**

用于实现牌的选中。当玩家点击卡槽中的牌时，获取鼠标点击的位置，并读取该位置在场景中的物体（即牌），再读取该牌在手牌中的索引（index），然后将其作为信号传递出去，来判断该牌是否可出。

# 三、 图表说明

## 1.     界面设计图

 ![](.\UI_sketch.png)

## 2.     类图

![](.\classDiagram.png)

# 四、运行效果图

# 五、心得体会

通过本次project，掌握了通过GitHub等协作工具进行的分工协作，了解了持续集成的概念和基本流程。同时学习了MVVM模式，掌握了程序分工之间沟通的技巧。并且深化了C++的相关知识，了解了Qt的图形框架，提高了编程能力。